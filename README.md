# Сравнение Puppet и Ansible
## Обзор

Сегодняшние специалисты по системному администрированию и devops должны в среднем управлять гораздо большим количеством серверов, на которых размещено гораздо большее количество приложений. Таким образом, такие инструменты, как Puppet и Ansible, быстро становятся важными компонентами для управления большим количеством серверов.

Puppet поддерживает как чистый Ruby, так и настроенный DSL для CLI, только поддержка для Ruby устарела. Это плохие новости для тех, кто изучил только Ruby, а не внутренний DSL.

Ansible обошла Puppet, чтобы захватить самую большую долю рынка в индустрии управления конфигурациями с [лидирующей долей 26,5%](https://www.datanyze.com/market-share/configuration-management).

Попытаемся сравнить Puppet и Ansible.

## Ключевые особенности

|                              | Puppet                                                     | Ansible                                      |
| ---------------------------- | ---------------------------------------------------------- | -------------------------------------------- |
| Архитектура                  | Клиент-Серверная                                           | Безагентная. Управление по SSH.              |
| Синтаксис                    | Puppet DSL                                                 | YAML                                         |
| На чем написан               | Ruby                                                       | Python                                       |
| Подключение к целевой машине | Агент нацелевой машине подключается по SSL к Puppet Server | Ansible подключается к целевой машине по SSH |

## Различия в настройках 

Чтобы настроить Ansible, вам нужно назначить отдельный узел в качестве управляющего узла. В действительности, любой из ваших узлов может быть управляющим узлом. Нет необходимости устанавливать клиентское программное обеспечение на других ваших узлах. Создайте пару ключей SSH на вашем управляющем узле, а затем скопируйте ее на остальные узлы. Создайте файл инвентаризации для ваших узлов Ansible. Ansible будет использовать SSH-соединения с вашими контролируемыми узлами для запуска ваших playbook.

Для Puppet, установка немного сложнее.  Вам необходимо настроить главный и агентский узлы, чтобы все они имели одинаковое время и часовой пояс. Войдите на главный сервер и установите Puppet Server. Запустите службу PuppetServer и включите ее для получения клиентских подключений через порт 8140. Вам нужно будет установить программное обеспечение Puppet Agent на каждом клиенте.

## Масштабируемость и транспортные механизмы 

Ansible использует механизм транспорта по умолчанию «smart», который обычно разрешается в SSH. Он откроет SSH-соединение и создаст временный каталог. После закрытия этого соединения Ansible открывает второе соединение для копирования кода модуля Ansible и исходного кода Ansible. Ansible закроет это соединение перед тем, как открыть третье, последнее соединение для выполнения кода. Первая функция, которую может использовать Ansible, называется ControlPersist, и она опирается на постоянные сокеты, чтобы сократить время и рукопожатие, необходимые для нескольких соединений. Ansible может быть сконфигурирован для обработки большего количества узлов инвентаря за один раз, настроив переменную forks в конфигурации Ansible.

Транспортным механизмом Puppet является HTTPS, который управляется через SSL-сертификаты. Один сервер Puppet будет обрабатывать запросы конфигурации из вашего инвентаря клиентов Puppet. Каждый клиент отправляет факты о Puppet мастеру и отправляет запрос на каталог Puppet. Затем мастер отправит каталог в ответ. Затем клиент обрабатывает каталог, проверяя каждый ресурс на соответствие требуемому состоянию конфигурации, указанному в каталоге.

В частности, модель обработки Puppet выделяет поток JRuby из пула потоков для обработки каждого входящего клиентского соединения. По мере того как количество ваших узлов увеличивается до больших размеров, вы можете настроить Puppet для лучшего масштабирования, увеличив число потоков JRuby, доступных в пуле. Вы можете установить его, как правило, так же высоко, как количество ядер ЦП на машина, однако, следует помнить, что для этого потребуется больше оперативной памяти. 

## Примеры кода

|      | Puppet | Ansible |
| ---- | ------ | ------- |
|      |        |         |
|      |        |         |
|      |        |         |
|      |        |         |
|      |        |         |

## Проблемы Puppet

Дублированный блок кода в 2 модулях вызовет ошибку.

В https://forge.puppet.com/ мало официальных поддерживаемых модулей.

